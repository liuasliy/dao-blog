{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.7133733ea5693f91ab7b.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import React from 'react';\r\n\r\nimport Link from 'next/link';\r\nimport Layout from '../components/Layout';\r\nimport LoadMore from '../components/LoadMore';\r\n\r\nimport Fetch from '../utils/axios';\r\nimport { api } from '../utils/api'\r\nimport fetch from 'isomorphic-unfetch';\r\n\r\n\r\nclass Index extends React.Component {\r\n    // static async getInitialProps() {\r\n    //     const req = await fetch(api.blog_list + `?page_size=3&page=${1}`);\r\n    //     const res = await req.json();\r\n    //     if (res.code === '0') {\r\n    //         return {\r\n    //             posts: res.data.list,\r\n    //             totalPage: res.data.totalPage\r\n    //         }\r\n    //     }\r\n    // }\r\n    state = {\r\n        _page: 1,\r\n        isLoadingMore: false,\r\n        totalPage: 0,\r\n        isComplete: false\r\n    }\r\n    loadMoreData() {\r\n        // 记录状态\r\n        this.setState({\r\n            isLoadingMore: true\r\n        })\r\n        this.resultHandle()\r\n    }\r\n    resultHandle() {\r\n        const page = this.state._page\r\n        this.setState({\r\n            _page: page + 1\r\n        }, () => {\r\n            if (this.state._page > this.state.totalPage) {\r\n                this.setState({\r\n                    isLoadingMore: false,\r\n                    isComplete: true\r\n                })\r\n                return false;\r\n            }\r\n            else {\r\n                //加载更多数据\r\n                Fetch({\r\n                    url: api.blog_list + `?page_size=3&page=${this.state._page}`,\r\n                    type: 'get',\r\n                }).then(res => {\r\n                    const { code, data } = res.data;\r\n                    if (code === '0') {\r\n                        this.setState({\r\n                            listData: this.state.listData.concat(data.list),\r\n                            isLoadingMore: false\r\n                        })\r\n                    }\r\n\r\n                })\r\n                    .catch(error => {\r\n                        console.log('error: ' + error)\r\n                    })\r\n            }\r\n        })\r\n\r\n\r\n    }\r\n    render() {\r\n        return (\r\n            <Layout>\r\n                <div className=\"d-home\">\r\n                    <div className=\"d-wrap\">\r\n                        {\r\n                            this.props.posts.map((item, indexs) => {\r\n                                return <article key={indexs}>\r\n                                    <h3 className=\"d-title\">\r\n                                        <Link as={`/article/detail/${item.id}`} href={`/detail?id=${item.id}`}>\r\n                                            <a><span>{item.title}</span></a>\r\n                                        </Link>\r\n                                    </h3>\r\n                                    <div className=\"d-content\">\r\n                                        {item.brief}\r\n                                    </div>\r\n                                    <div className=\"d-intro\">\r\n                                        <span className=\"d-date\">{item.pubdate}</span>\r\n                                        <span className=\"d-tags\">\r\n                                            {\r\n                                                item.tags.map((items, index) => {\r\n                                                    return\r\n                                                    <Link as={`/article/tag/${items.id}`} href={`/tag?id=${items.id}`}>\r\n                                                        <a >{items}</a>\r\n                                                    </Link>\r\n                                                })\r\n                                            }\r\n                                        </span>\r\n                                        <span className=\"d-view-num\">阅读:{item.read_count}</span>\r\n                                    </div>\r\n                                </article>\r\n                            })\r\n                        }\r\n                        {\r\n                            this.state.isComplete ? <div className=\"load-more\">已经没有更多数据啦~</div> : <LoadMore isLoadingMore={this.state.isLoadingMore} loadMoreFn={this.loadMoreData.bind(this)} />\r\n                        }\r\n\r\n                    </div>\r\n                    \r\n                </div>\r\n\r\n            </Layout>\r\n        )\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\nIndex.getInitialProps = async function () {\r\n    console.log(111)\r\n    const res = await fetch(api.blog_list+`?page_size=10&page=${1}`);\r\n    const data = await res.json();\r\n    if(data.code === '0'){\r\n        return {\r\n            posts: data.data.list,\r\n            totalPage: data.data.totalPage\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default Index;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AAJA;AACA;;;;;;AAKA;AACA;AACA;AACA;AADA;AAGA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AAGA;;;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAIA;AAAA;AAGA;AAAA;AACA;AAAA;AACA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAGA;AAGA;AAAA;AAGA;AAGA;AAAA;AAAA;AAAA;AAAA;AASA;;;;AAtGA;AACA;AA2GA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AACA;AADA;AAMA;AACA;AAFA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;;;;A","sourceRoot":""}